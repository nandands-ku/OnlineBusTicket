@model OBTM.Core.Models.TripBase

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Index";
}

<div class="row">
    <div class="col-xs-2">@Html.Partial("NavbarPartial")</div>
    <div class="col-xs-10">
        <h2>Trips</h2>
        <div class="row">
            <div class="form-group col-xs-4">
                @Html.Label("Bus Operator", htmlAttributes: new { @class = "control-label col-sx-6" })
                <div class="col-xs-10">
                    @Html.DropDownListFor(model => model.BusOperatorId, (SelectList)ViewBag.BusOperatorList, "Select Bus Operator", new { @class = "form-control", @id = "busOparetorDrpDown", required = "required" })
                    @Html.ValidationMessageFor(model => model.BusOperatorId, "", new { @class = "text-danger" })
                </div>
            </div>

            <div class="form-group col-xs-4">
                <label class="control-label col-xs-6">Route</label>
                <div class="col-xs-10">
                    <select class="form-control " name="RouteId" id="routeDropDown">
                        <option>Select Route</option>
                    </select>
                </div>
            </div>
            <div class="form-group col-xs-4">

                <div class="row">
                    <br />
                    <button class="btn btn-primary" type="button" id="btnSubmit">Submit</button>
                </div>
            </div>

        </div>
        <div class="row">
            <div id="tripList">
            </div>
        </div>
    </div>
</div>

@section scripts{
    <script>
    $(document).ready(function () {

        $("#busOparetorDrpDown").change(function () {
            var id = $("#busOparetorDrpDown").val() == "" ? 0 : $("#busOparetorDrpDown").val();
            GetBusRoute(id);
        });
        $("#busOparetorDrpDown").trigger("change");
        $("#btnSubmit").trigger("click");

        $("#btnSubmit").click(function () {

            var operatorId = $(busOparetorDrpDown).val();
            var routeId = $(routeDropDown).val();
            debugger;
            if (operatorId == "") {
                alert("Select Bus Operator");
                return false;
            }
            if (routeId == null) {
                alert("Select Route");
                return false;
            }

            GetBusTrips(operatorId,routeId);
        });


        function GetBusRoute(id) {
            $.ajax({
                type: "GET",
                url: "/TripBase/GetBusRoute",
                data: { id: id },
                //cache: false,

                success: function (data) {
                    var options = '';
                    for (var i = 0; i < data.length; i++) {
                        options += '<option  value="' + data[i].Id + '">' + data[i].RouteName + '</option>';
                    }
                    $("#routeDropDown").html(options);
                     $("#routeDropDown").val("@Html.Raw(Model != null ? Model.RouteId : 0)");
                }
            });
        };


        function GetBusTrips(operatorId, routeId) {

            $.ajax({
                type: "GET",
                url: "/TripBase/GetBusTrips",
                data: { operatorId: operatorId, routeId: routeId },
                //cache: false,

                success: function (data) {

                    $("#tripList").html(data);

                }
            });
        };

    });



    </script>

}